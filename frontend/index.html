<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Land Registry Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Web3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .navbar { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .btn-custom { border-radius: 8px; font-weight: 600; }
        
        /* ADMIN PANEL HIDDEN BY DEFAULT */
        #adminPanel { display: none; border-left: 5px solid #dc3545; }
        
        .role-icon { font-size: 2rem; margin-bottom: 10px; color: #6c757d; }
        .table-responsive { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-landmark me-2"></i>BlockLand Registry</a>
            <div class="d-flex align-items-center">
                <span id="accountArea" class="text-light me-3 small">Not Connected</span>
                <button id="connectBtn" class="btn btn-primary btn-sm btn-custom" onclick="connectWallet()">
                    <i class="fas fa-wallet me-2"></i>Connect Wallet
                </button>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        
        <!-- Quick Stats Row -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-center p-3 text-white bg-primary bg-gradient">
                    <h3><i class="fas fa-users me-2"></i>Sellers</h3>
                    <h2 id="statSellers">-</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center p-3 text-white bg-success bg-gradient">
                    <h3><i class="fas fa-tree me-2"></i>Lands Listed</h3>
                    <h2 id="statLands">-</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center p-3 text-white bg-warning bg-gradient text-dark">
                    <h3><i class="fas fa-hand-holding-usd me-2"></i>Requests</h3>
                    <h2 id="statRequests">-</h2>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- LEFT COLUMN: User Actions -->
            <div class="col-lg-4">
                
                <!-- SELLER ACTIONS -->
                <div class="card">
                    <div class="card-body">
                        <div class="text-center"><i class="fas fa-user-tie role-icon text-primary"></i></div>
                        <h5 class="card-title text-center text-primary fw-bold">Seller Zone</h5>
                        <hr>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-custom" data-bs-toggle="modal" data-bs-target="#registerSellerModal">
                                <i class="fas fa-plus-circle me-2"></i>Register as Seller
                            </button>
                            <button class="btn btn-outline-primary btn-custom" data-bs-toggle="modal" data-bs-target="#addLandModal">
                                <i class="fas fa-map-marked-alt me-2"></i>Add New Land
                            </button>
                            <div class="input-group mt-2">
                                <input type="number" id="approveRequestId" class="form-control" placeholder="Request ID">
                                <button class="btn btn-primary" onclick="approveRequest()">Approve</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BUYER ACTIONS -->
                <div class="card">
                    <div class="card-body">
                        <div class="text-center"><i class="fas fa-shopping-cart role-icon text-success"></i></div>
                        <h5 class="card-title text-center text-success fw-bold">Buyer Zone</h5>
                        <hr>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-success btn-custom" data-bs-toggle="modal" data-bs-target="#registerBuyerModal">
                                <i class="fas fa-user-plus me-2"></i>Register as Buyer
                            </button>
                            <div class="input-group mt-2">
                                <input type="number" id="requestLandId" class="form-control" placeholder="Land ID">
                                <button class="btn btn-success" onclick="requestLand()">Request</button>
                            </div>
                            <div class="input-group mt-2">
                                <input type="number" id="payLandId" class="form-control" placeholder="Land ID">
                                <button class="btn btn-warning text-dark" onclick="makePayment()">Pay Now üí≥</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- RIGHT COLUMN: Admin & Data -->
            <div class="col-lg-8">
                
                <!-- ADMIN DASHBOARD (Smart Inbox Version) -->
                <div id="adminPanel" class="card shadow-lg">
                    <div class="card-header bg-danger text-white fw-bold d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-user-shield me-2"></i>ADMIN CONSOLE</span>
                        <button class="btn btn-sm btn-light text-danger fw-bold" onclick="loadAdminRequests()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh Inbox
                        </button>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="adminTabs">
                            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#verifyTab">
                                üîî Pending Verifications <span id="badgeVerify" class="badge bg-warning text-dark">0</span>
                            </a></li>
                            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#transferTab">
                                ‚úçÔ∏è Transfer Requests <span id="badgeTransfer" class="badge bg-warning text-dark">0</span>
                            </a></li>
                        </ul>
                        
                        <div class="tab-content p-3">
                            <!-- Verification Inbox -->
                            <div class="tab-pane fade show active" id="verifyTab">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Role</th>
                                                <th>Wallet Address</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="verificationTableBody">
                                            <tr><td colspan="3" class="text-center text-muted">Scanning for requests...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Transfer Inbox -->
                            <div class="tab-pane fade" id="transferTab">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Land ID</th>
                                                <th>Current Owner</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="transferTableBody">
                                            <tr><td colspan="4" class="text-center text-muted">Scanning for paid lands...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PUBLIC REGISTRY -->
                <div class="card mt-4">
                    <div class="card-header bg-light fw-bold">
                        <i class="fas fa-globe me-2"></i>Public Land Registry
                    </div>
                    <div class="card-body">
                        <div class="input-group mb-3">
                            <input type="number" id="searchLandId" class="form-control" placeholder="Enter Land ID (e.g. 1)">
                            <button class="btn btn-dark" onclick="getLandDetails()">Search Registry</button>
                        </div>
                        <div id="landResult" class="mt-3">
                            <div class="alert alert-secondary text-center">Enter an ID to view details</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- MODALS (Popups for Registration) -->
    
    <!-- Register Seller Modal -->
    <div class="modal fade" id="registerSellerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Register as Seller</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="sellerName" class="form-control mb-2" placeholder="Full Name">
                    <input type="number" id="sellerAge" class="form-control mb-2" placeholder="Age">
                    <input type="text" id="sellerAadhar" class="form-control mb-2" placeholder="Aadhar Number">
                    <input type="text" id="sellerPan" class="form-control mb-2" placeholder="Pan Number">
                    <input type="text" id="sellerLands" class="form-control mb-2" placeholder="Lands Location">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="registerSeller()">Submit Registration</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Land Modal -->
    <div class="modal fade" id="addLandModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Add New Land Asset</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-2">
                        <div class="col-md-6"><input type="number" id="landArea" class="form-control" placeholder="Area (Sq ft)"></div>
                        <div class="col-md-6"><input type="text" id="landCity" class="form-control" placeholder="City"></div>
                        <div class="col-md-6"><input type="text" id="landState" class="form-control" placeholder="State"></div>
                        <div class="col-md-6"><input type="number" id="landPrice" class="form-control" placeholder="Price (Wei)"></div>
                        <div class="col-md-6"><input type="number" id="landPID" class="form-control" placeholder="PID"></div>
                        <div class="col-md-6"><input type="number" id="landSurvey" class="form-control" placeholder="Survey No"></div>
                        <div class="col-12"><input type="text" id="ipfsHash" class="form-control" placeholder="Image URL"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="addLand()">Tokenize Land</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Buyer Modal -->
    <div class="modal fade" id="registerBuyerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Register as Buyer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="buyerName" class="form-control mb-2" placeholder="Full Name">
                    <input type="number" id="buyerAge" class="form-control mb-2" placeholder="Age">
                    <input type="text" id="buyerCity" class="form-control mb-2" placeholder="City">
                    <input type="text" id="buyerAadhar" class="form-control mb-2" placeholder="Aadhar Number">
                    <input type="text" id="buyerPan" class="form-control mb-2" placeholder="Pan Number">
                    <input type="email" id="buyerEmail" class="form-control mb-2" placeholder="Email Address">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="registerBuyer()">Submit Registration</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>